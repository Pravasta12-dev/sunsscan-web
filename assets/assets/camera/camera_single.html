<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <style>
    body {
      margin: 0;
      background: black;
    }
    video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    canvas {
      display: none;
    }
  </style>
</head>
<body>

<video id="video" autoplay playsinline></video>
<canvas id="canvas"></canvas>

<script>
  const video = document.getElementById('video');
  const canvas = document.getElementById('canvas');
  let stream;

  async function startCamera() {
    try {
      console.log('Requesting camera access...');
      
      // Cek apakah getUserMedia tersedia
      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        throw new Error('getUserMedia is not supported in this browser');
      }

      // Request camera dengan constraints yang lebih spesifik
      const constraints = {
        video: {
          width: { ideal: 1280 },
          height: { ideal: 720 },
          facingMode: 'user' // atau 'environment' untuk kamera belakang
        },
        audio: false
      };

      stream = await navigator.mediaDevices.getUserMedia(constraints);
      console.log('Camera stream obtained:', stream);
      
      video.srcObject = stream;
      
      // Tambahkan event listener untuk memastikan video mulai play
      video.onloadedmetadata = function(e) {
        console.log('Video metadata loaded');
        video.play().then(() => {
          console.log('Video playing successfully');
        }).catch(err => {
          console.error('Error playing video:', err);
        });
      };

    } catch (err) {
      console.error('Error accessing camera:', err);
      alert('Error: ' + err.message + '\n\nPastikan:\n1. Browser memiliki akses ke kamera\n2. Kamera tidak digunakan aplikasi lain\n3. Anda mengizinkan akses kamera');
    }
  }

  window.capturePhoto = function () {
    if (video.videoWidth === 0 || video.videoHeight === 0) {
      console.error('Video not ready');
      return null;
    }
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    canvas.getContext('2d').drawImage(video, 0, 0);
    return canvas.toDataURL('image/jpeg', 0.9);
  };

  // Tunggu DOM ready sebelum start camera
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', startCamera);
  } else {
    startCamera();
  }
</script>

</body>
</html>
